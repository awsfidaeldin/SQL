-- Q1
SET SERVEROUTPUT ON;
CREATE OR REPLACE PROCEDURE DISPLAY_EMP(DEPT_ID1 NUMBER,DEPT_ID2 NUMBER)
IS
CURSOR CUR IS
  SELECT E.ENAME,D.DEPTNO,D.DNAME
  FROM EMP E,DEPT D
  WHERE E.DEPTNO=D.DEPTNO
  AND (E.DEPTNO=DEPT_ID1 OR E.DEPTNO=DEPT_ID2) ;
BEGIN
FOR I IN CUR
LOOP
  DBMS_OUTPUT.PUT_LINE(I.ENAME||' '||I.DEPTNO||' '||I.DNAME);
END LOOP;
END;

-- EXEC DISPLAY_EMP(10,20);

--Q2
CREATE OR REPLACE FUNCTION FINDNAME
RETURN VARCHAR2 IS
  V_NAME VARCHAR2(10);
BEGIN
  SELECT ENAME
  INTO V_NAME
  FROM EMP
  WHERE SAL=(SELECT MAX(SAL) FROM EMP);
  RETURN V_NAME;
END;

/*
DECLARE
  N VARCHAR(10);
BEGIN
  N:=FINDNAME();
  DBMS_OUTPUT.PUT_LINE('THE NAME IS '||N);
END;
*/

--Q3
CREATE OR REPLACE TRIGGER FEEDBACK
AFTER DELETE OR UPDATE ON DEPT
DECLARE
CURSOR CUR IS
  SELECT *
  FROM DEPT;
BEGIN
FOR I IN CUR
LOOP
DBMS_OUTPUT.PUT_LINE('DEPTNO = '||I.DEPTNO);
DBMS_OUTPUT.PUT_LINE('DNAME = '||I.DNAME);
DBMS_OUTPUT.PUT_LINE('LOCATION = '||I.LOC);
END LOOP;
DBMS_OUTPUT.PUT_LINE('USER = '||USER);
DBMS_OUTPUT.PUT_LINE('TRANSACTION DATE = '||SYSDATE);
END;

/*
UPDATE DEPT
SET LOC ='DENVER'
WHERE LOC='DALLAS';

SELECT * FROM DEPT;
*/